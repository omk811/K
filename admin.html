<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:"Cairo",sans-serif;
  background:linear-gradient(135deg,#0f0f1e,#16213e);
  color:#f1f5f9;
  min-height:100vh;
  padding:20px
}
.container{max-width:1100px;margin:auto}

/* ====== Ø£Ø²Ø±Ø§Ø± ====== */
.btn{
  padding:14px 20px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-family:inherit;
  font-weight:700;
  transition:.3s;
}
.btn:hover{transform:translateY(-2px)}
.btn-primary{background:#8b5cf6;color:#fff}
.btn-success{background:#10b981;color:#fff}
.btn-warning{background:#f59e0b;color:#fff}
.btn-danger{background:#ef4444;color:#fff}
.btn-secondary{background:#374151;color:#fff}

/* ====== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ====== */
.login-card{
  max-width:420px;
  margin:120px auto;
  background:#1e1e2e;
  padding:40px;
  border-radius:20px;
  text-align:center
}
.login-card h2{color:#a78bfa;margin-bottom:10px}
.login-card input{
  width:100%;
  padding:16px;
  border-radius:12px;
  border:2px solid #8b5cf6;
  background:#0f172a;
  color:#fff;
  margin:20px 0
}

/* ====== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ====== */
.hidden{display:none}
.panel-header{
  background:#1e1e2e;
  padding:30px;
  border-radius:20px;
  margin-bottom:25px;
  text-align:center
}
.panel-header h2{color:#a78bfa}

.card{
  background:#1e1e2e;
  padding:25px;
  border-radius:18px;
  margin-bottom:25px
}

.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:6px}
.form-group input,select{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:2px solid #8b5cf6;
  background:#0f172a;
  color:#fff
}

/* ====== Ø§Ù„Ø¯Ø±ÙˆØ³ ====== */
.lesson-card{
  background:#0f172a;
  border:1px solid #8b5cf633;
  border-radius:16px;
  padding:20px;
  margin-bottom:15px
}
.lesson-title{
  font-weight:700;
  margin-bottom:10px;
  display:flex;
  gap:10px;
  align-items:center
}
.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700
}
.b1{background:#3b82f6}
.b2{background:#10b981}
.meta{font-size:14px;color:#cbd5e1;margin-bottom:10px}
.actions{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>

<body>
<div class="container">

<!-- ====== LOGIN ====== -->
<div id="loginBox" class="login-card">
  <h2>ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
  <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button class="btn btn-primary" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <div id="loginMsg"></div>
</div>

<!-- ====== PANEL ====== -->
<div id="panel" class="hidden">

  <div class="panel-header">
    <h2>ğŸ“š Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h2>
    <p>ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
  </div>

  <!-- Ø¥Ø¶Ø§ÙØ© -->
  <div class="card">
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</h3>
    <div class="form-group">
      <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
      <input id="title">
    </div>
    <div class="form-group">
      <label>Ø§Ù„Ø±Ø§Ø¨Ø·</label>
      <input id="url">
    </div>
    <div class="form-group">
      <label>Ø§Ù„Ø£Ø³ØªØ§Ø°</label>
      <input id="author" value="Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ">
    </div>
    <div class="form-group">
      <label>Ø§Ù„ÙØµÙ„</label>
      <select id="semester">
        <option value="1">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</option>
        <option value="2">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
      </select>
    </div>
    <button class="btn btn-success" onclick="addLesson()">Ø¥Ø¶Ø§ÙØ©</button>
    <div id="status"></div>
  </div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© -->
  <div class="card">
    <h3>ğŸ“‹ Ø§Ù„Ø¯Ø±ÙˆØ³</h3>
    <div id="list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
  </div>

</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbxuf794HZmIMIjofGEunan_GRJNH6Npn_fHcZsMZShss90Z4ilPRwpQjRVUGJd2fOSqnw/exec";
let ADMIN_PASS="";
let allLessons=[];
let editingId=null;

/* ===== LOGIN ===== */
function login(){
  ADMIN_PASS=document.getElementById("pass").value.trim();
  fetch(API,{method:"POST",body:JSON.stringify({action:"get",password:ADMIN_PASS})})
  .then(r=>r.json())
  .then(d=>{
    if(d.error){document.getElementById("loginMsg").textContent="âŒ Ø®Ø·Ø£";}
    else{
      loginBox.classList.add("hidden");
      panel.classList.remove("hidden");
      loadLessons();
    }
  });
}

/* ===== LOAD ===== */
function loadLessons(){
  list.innerHTML="â³ ØªØ­Ù…ÙŠÙ„â€¦";
  fetch(API,{method:"POST",body:JSON.stringify({action:"get",password:ADMIN_PASS})})
  .then(r=>r.json())
  .then(data=>{
    allLessons=data
      .filter(l=>l.status!=="DELETED")
      .map(l=>({...l,_ts:l.publish_date?new Date(l.publish_date).getTime():0}))
      .sort((a,b)=>{
        if(a.pinned==="YES"&&b.pinned!=="YES")return -1;
        if(a.pinned!=="YES"&&b.pinned==="YES")return 1;
        return b._ts-a._ts;
      });
    render(allLessons);
  });
}

/* ===== RENDER ===== */
function render(arr){
  list.innerHTML="";
  arr.forEach(l=>{
    const div=document.createElement("div");
    div.className="lesson-card";
    div.innerHTML=`
      <div class="lesson-title">
        <span class="badge ${l.semester==="1"?"b1":"b2"}">
          ${l.semester==="1"?"Ø§Ù„Ø£ÙˆÙ„":"Ø§Ù„Ø«Ø§Ù†ÙŠ"}
        </span>
        ${l.pinned==="YES"?"ğŸ“Œ":""}
        ${l.title}
      </div>
      <div class="meta">
        ğŸ‘ï¸ ${l.views||0} | ğŸ“… ${l.publish_date||"-"} | âœï¸ ${l.author||"-"}
      </div>
      <div class="actions">
        <button class="btn btn-success" onclick="toggle('${l.id}','${l.status==="ON"?"OFF":"ON"}')">
          ${l.status==="ON"?"Ù…Ù†Ø´ÙˆØ±":"Ù…Ø®ÙÙŠ"}
        </button>
        <button class="btn btn-secondary" onclick="pin('${l.id}','${l.pinned==="YES"?"NO":"YES"}')">
          ğŸ“Œ ØªØ«Ø¨ÙŠØª
        </button>
        <button class="btn btn-warning" onclick="edit('${l.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn btn-danger" onclick="del('${l.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>
    `;
    list.appendChild(div);
  });
}

/* ===== ACTIONS ===== */
function addLesson(){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"add",
      password:ADMIN_PASS,
      title:title.value,
      url:url.value,
      author:author.value,
      semester:semester.value
    })
  }).then(()=>loadLessons());
}

function toggle(id,status){
  fetch(API,{method:"POST",body:JSON.stringify({action:"toggle",password:ADMIN_PASS,id,status})})
  .then(()=>loadLessons());
}

function pin(id,pinned){
  fetch(API,{method:"POST",body:JSON.stringify({action:"pin",password:ADMIN_PASS,id,pinned})})
  .then(()=>loadLessons());
}

function del(id){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ØŸ"))return;
  fetch(API,{method:"POST",body:JSON.stringify({action:"delete",password:ADMIN_PASS,id})})
  .then(()=>loadLessons());
}

/* ===== EDIT ===== */
function edit(id){
  const l=allLessons.find(x=>x.id===id);
  const t=prompt("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",l.title);
  if(!t)return;
  const u=prompt("Ø§Ù„Ø±Ø§Ø¨Ø·",l.url);
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"edit",
      password:ADMIN_PASS,
      id,
      title:t,
      url:u,
      author:l.author,
      semester:l.semester
    })
  }).then(()=>loadLessons());
}
</script>

</body>
</html>
