<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Cairo", sans-serif;
  background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 50%, #16213e 100%);
  color: #f1f5f9;
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1100px;
  margin: 0 auto;
}

/* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-card {
  max-width: 450px;
  margin: 100px auto;
  background: rgba(30, 30, 46, 0.95);
  backdrop-filter: blur(20px);
  padding: 50px 40px;
  border-radius: 24px;
  box-shadow: 0 25px 70px rgba(0,0,0,0.5);
  border: 1px solid rgba(139,92,246,0.3);
  animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.login-icon {
  text-align: center;
  font-size: 5em;
  margin-bottom: 20px;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.login-card h2 {
  text-align: center;
  color: #a78bfa;
  font-size: 2.2em;
  margin-bottom: 10px;
  font-weight: 900;
}

.login-card .subtitle {
  text-align: center;
  color: #94a3b8;
  font-size: 1em;
  margin-bottom: 40px;
}

.input-group {
  position: relative;
  margin-bottom: 30px;
}

.input-group input {
  width: 100%;
  padding: 18px 55px 18px 20px;
  border-radius: 14px;
  border: 2px solid rgba(139,92,246,0.3);
  background: rgba(15, 15, 30, 0.7);
  color: #f1f5f9;
  font-family: inherit;
  font-size: 1.05em;
  transition: all 0.3s ease;
}

.input-group input:focus {
  outline: none;
  border-color: #8b5cf6;
  box-shadow: 0 0 0 4px rgba(139,92,246,0.2);
  background: rgba(15, 15, 30, 0.9);
}

.input-group .icon {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.4em;
}

.btn {
  width: 100%;
  padding: 18px;
  border-radius: 14px;
  border: none;
  font-family: inherit;
  font-size: 1.1em;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn:hover::before {
  width: 400px;
  height: 400px;
}

.btn-primary {
  background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
  color: #fff;
  box-shadow: 0 10px 30px rgba(139,92,246,0.3);
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 40px rgba(139,92,246,0.5);
}

.btn-secondary {
  background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
  color: #fff;
}

.btn-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(55,65,81,0.4);
}

.btn-success {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(16,185,129,0.4);
}

.btn-warning {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: #fff;
}

.btn-warning:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(245,158,11,0.4);
}

.btn-refresh {
  background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
  color: #fff;
}

.btn-refresh:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(14,165,233,0.4);
}

.error-msg {
  text-align: center;
  margin-top: 25px;
  padding: 15px;
  border-radius: 12px;
  background: rgba(239,68,68,0.2);
  color: #fca5a5;
  border: 2px solid rgba(239,68,68,0.3);
  animation: shake 0.5s;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
.panel {
  animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.panel-header {
  background: linear-gradient(135deg, rgba(139,92,246,0.2) 0%, rgba(16,185,129,0.2) 100%);
  backdrop-filter: blur(20px);
  padding: 40px;
  border-radius: 24px;
  margin-bottom: 30px;
  border: 1px solid rgba(139,92,246,0.3);
  text-align: center;
  box-shadow: 0 15px 50px rgba(0,0,0,0.3);
}

.panel-header h2 {
  font-size: 2.5em;
  color: #a78bfa;
  font-weight: 900;
  margin-bottom: 10px;
}

.panel-header p {
  color: #cbd5e1;
  font-size: 1.1em;
}

.action-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 35px;
}

.card {
  background: rgba(30, 30, 46, 0.9);
  backdrop-filter: blur(20px);
  padding: 35px;
  border-radius: 20px;
  border: 1px solid rgba(139,92,246,0.2);
  margin-bottom: 30px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.card h3 {
  color: #a78bfa;
  font-size: 1.7em;
  margin-bottom: 25px;
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 700;
  padding-bottom: 15px;
  border-bottom: 2px solid rgba(139,92,246,0.2);
}

.form-group {
  margin-bottom: 22px;
}

.form-group label {
  display: block;
  margin-bottom: 10px;
  color: #cbd5e1;
  font-weight: 600;
  font-size: 1em;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 16px 20px;
  border-radius: 12px;
  border: 2px solid rgba(139,92,246,0.3);
  background: rgba(15, 15, 30, 0.7);
  color: #f1f5f9;
  font-family: inherit;
  font-size: 1em;
  transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #8b5cf6;
  box-shadow: 0 0 0 4px rgba(139,92,246,0.2);
  background: rgba(15, 15, 30, 0.9);
}

.status-msg {
  text-align: center;
  margin-top: 25px;
  padding: 16px;
  border-radius: 12px;
  font-weight: 700;
  animation: slideDown 0.4s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-15px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.status-msg.success {
  background: rgba(16,185,129,0.2);
  color: #6ee7b7;
  border: 2px solid rgba(16,185,129,0.3);
}

.status-msg.error {
  background: rgba(239,68,68,0.2);
  color: #fca5a5;
  border: 2px solid rgba(239,68,68,0.3);
}

/* ÙÙ„Ø§ØªØ± Ø§Ù„Ø¯Ø±ÙˆØ³ */
.filters {
  display: flex;
  gap: 12px;
  margin-bottom: 25px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 12px 24px;
  border-radius: 12px;
  border: 2px solid rgba(139,92,246,0.3);
  background: rgba(15, 15, 30, 0.7);
  color: #cbd5e1;
  font-family: inherit;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.95em;
}

.filter-btn:hover {
  background: rgba(139,92,246,0.2);
  transform: translateY(-2px);
  border-color: rgba(139,92,246,0.5);
}

.filter-btn.active {
  background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
  color: white;
  border-color: #8b5cf6;
  box-shadow: 0 8px 25px rgba(139,92,246,0.4);
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ */
.lessons-grid {
  display: grid;
  gap: 20px;
}

.lesson-card {
  background: linear-gradient(135deg, rgba(15,15,30,0.9) 0%, rgba(30,30,46,0.8) 100%);
  padding: 28px;
  border-radius: 18px;
  border: 1px solid rgba(139,92,246,0.2);
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
}

.lesson-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, #8b5cf6 0%, #10b981 100%);
  transition: width 0.4s ease;
}

.lesson-card:hover {
  transform: translateX(-5px);
  border-color: rgba(139,92,246,0.5);
  box-shadow: 0 15px 40px rgba(139,92,246,0.3);
}

.lesson-card:hover::before {
  width: 100%;
  opacity: 0.05;
}

.lesson-title {
  font-size: 1.3em;
  font-weight: 700;
  color: #e2e8f0;
  margin-bottom: 18px;
  line-height: 1.5;
  display: flex;
  align-items: start;
  gap: 10px;
}

.semester-badge {
  display: inline-block;
  padding: 5px 14px;
  border-radius: 20px;
  font-size: 0.7em;
  font-weight: 700;
  white-space: nowrap;
  flex-shrink: 0;
}

.semester-1 {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(59,130,246,0.3);
}

.semester-2 {
  background: linear-gradient(135deg, #10b981 0%, #047857 100%);
  color: white;
  box-shadow: 0 4px 15px rgba(16,185,129,0.3);
}

.lesson-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 18px;
  margin-bottom: 20px;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 8px;
  color: #94a3b8;
  font-size: 0.95em;
}

.meta-item strong {
  color: #cbd5e1;
}

.lesson-actions {
  display: flex;
  gap: 12px;
  margin-top: 18px;
  flex-wrap: wrap;
}

.btn-toggle {
  flex: 1;
  min-width: 150px;
  padding: 14px 20px;
  border-radius: 12px;
  border: none;
  font-family: inherit;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.95em;
}

.btn-toggle.on {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  box-shadow: 0 6px 20px rgba(16,185,129,0.3);
}

.btn-toggle.off {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: #fff;
  box-shadow: 0 6px 20px rgba(239,68,68,0.3);
}

.btn-toggle:hover {
  transform: scale(1.05);
}

.btn-edit { 
  /* Ø­Ø§Ù„ÙŠÙ‹Ø§ ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„ â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ */
  background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
  color: #fff;
  border: none;
  padding: 14px 20px;
  border-radius: 12px;
  cursor: pointer;
  font-family: inherit;
  font-weight: 700;
  transition: all 0.3s ease;
  font-size: 0.95em;
  opacity: 0.6;
  pointer-events: none;
}

.btn-edit:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139,92,246,0.5);
}

.loading {
  text-align: center;
  padding: 60px 20px;
  color: #94a3b8;
  font-size: 1.2em;
}

.loading::after {
  content: '';
  display: block;
  width: 50px;
  height: 50px;
  margin: 25px auto;
  border: 4px solid rgba(139,92,246,0.3);
  border-top-color: #8b5cf6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.hidden {
  display: none !important;
}

@media (max-width: 768px) {
  .login-card { margin: 50px auto; padding: 35px 25px; }
  .panel-header { padding: 30px 20px; }
  .panel-header h2 { font-size: 1.8em; }
  .card { padding: 25px 20px; }
  .action-buttons { grid-template-columns: 1fr; }
  .filters { flex-direction: column; }
  .filter-btn { width: 100%; }
  .lesson-actions { flex-direction: column; }
  .btn-toggle { min-width: 100%; }
}
</style>
</head>

<body>

<div class="container">
  
  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginBox" class="login-card">
    <div class="login-icon">ğŸ”</div>
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h2>
    <p class="subtitle">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</p>
    
    <div class="input-group">
      <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" onkeypress="if(event.key==='Enter') login()">
      <span class="icon">ğŸ”‘</span>
    </div>
    
    <button class="btn btn-primary" onclick="login()">
      <span style="position: relative; z-index: 1;">ğŸš€ Ø¯Ø®ÙˆÙ„</span>
    </button>
    
    <div id="loginMsg"></div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div id="panel" class="panel hidden">
    
    <div class="panel-header">
      <h2>ğŸ“š Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h2>
      <p>Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯Ø±ÙˆØ³ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</p>
    </div>

    <div class="action-buttons">
      <button class="btn btn-secondary" onclick="goHome()">
        <span style="position: relative; z-index: 1;">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </button>
      <button class="btn btn-refresh" onclick="loadLessons()">
        <span style="position: relative; z-index: 1;">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
      </button>
      <button class="btn btn-warning" onclick="showSemesterStats()">
        <span style="position: relative; z-index: 1;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØµÙˆÙ„</span>
      </button>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ -->
    <div class="card">
      <h3>â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯</h3>
      
      <div class="form-group">
        <label>ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</label>
        <input id="title" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„ - Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">
      </div>
      
      <div class="form-group">
        <label>ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø±Ø³</label>
        <input id="url" placeholder="https://example.com/lesson">
      </div>
      
      <div class="form-group">
        <label>âœï¸ Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°</label>
        <input id="author" placeholder="Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ" value="Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ">
      </div>

      <div class="form-group">
        <label>ğŸ“š Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
        <select id="semester">
          <option value="1">ğŸ“˜ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</option>
          <option value="2">ğŸ“— Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
        </select>
      </div>

      <button class="btn btn-success" onclick="addLesson()">
        <span style="position: relative; z-index: 1;">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³</span>
      </button>

      <div id="status"></div>
    </div>

    <!-- ÙÙ„ØªØ± -->
    <div class="card">
      <h3>ğŸ¯ ØªØµÙÙŠØ© Ø§Ù„Ø¯Ø±ÙˆØ³</h3>
      <div class="filters">
        <button class="filter-btn active" onclick="filterLessons('all')">ğŸ“– Ø§Ù„ÙƒÙ„</button>
        <button class="filter-btn" onclick="filterLessons('1')">ğŸ“˜ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</button>
        <button class="filter-btn" onclick="filterLessons('2')">ğŸ“— Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
        <button class="filter-btn" onclick="filterLessons('ON')">ğŸŸ¢ Ù…Ù†Ø´ÙˆØ±</button>
        <button class="filter-btn" onclick="filterLessons('OFF')">ğŸ”´ ØºÙŠØ± Ù…Ù†Ø´ÙˆØ±</button>
      </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ -->
    <div class="card">
      <h3>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h3>
      <div id="list" class="lessons-grid">
        <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³</div>
      </div>
    </div>

  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxuf794HZmIMIjofGEunan_GRJNH6Npn_fHcZsMZShss90Z4ilPRwpQjRVUGJd2fOSqnw/exec";
let ADMIN_PASS = "";
let allLessons = [];

function setStatus(msg, isSuccess) {
  const div = document.getElementById("status");
  div.className = "status-msg " + (isSuccess ? "success" : "error");
  div.textContent = msg;
  setTimeout(() => {
    if (div.textContent === msg) div.textContent = "";
  }, 5000);
}

function login() {
  ADMIN_PASS = document.getElementById("pass").value.trim();
  if (!ADMIN_PASS) {
    showLoginError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
    return;
  }

  const loginBtn = event.target;
  const originalText = loginBtn.innerHTML;
  loginBtn.innerHTML = '<span style="position: relative; z-index: 1;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span>';
  loginBtn.disabled = true;

  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "get",
      password: ADMIN_PASS
    })
  })
  .then(r => r.json())
  .then(d => {
    loginBtn.innerHTML = originalText;
    loginBtn.disabled = false;
    if (d.error) {
      showLoginError("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    } else {
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("panel").classList.remove("hidden");
      loadLessons();
    }
  })
  .catch(err => {
    loginBtn.innerHTML = originalText;
    loginBtn.disabled = false;
    showLoginError("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
    console.error("Login error:", err);
  });
}

function showLoginError(msg) {
  const msgDiv = document.getElementById("loginMsg");
  msgDiv.className = "error-msg";
  msgDiv.textContent = msg;
}

function loadLessons() {
  document.getElementById("list").innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "get",
      password: ADMIN_PASS
    })
  })
  .then(r => r.json())
  .then(data => {
    if (Array.isArray(data)) {
      allLessons = data;
      displayLessons(data);
    } else {
      document.getElementById("list").innerHTML = `<div style="text-align:center; padding:40px; color:#fca5a5">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>`;
    }
  })
  .catch(err => {
    document.getElementById("list").innerHTML = `<div style="text-align:center; padding:40px; color:#fca5a5">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>`;
    console.error("Load error:", err);
  });
}

function displayLessons(lessons) {
  const box = document.getElementById("list");
  if (lessons.length === 0) {
    box.innerHTML = `
      <div style="text-align:center; padding:50px; color:#94a3b8">
        <div style="font-size: 4em; margin-bottom: 15px; opacity: 0.5;">ğŸ“­</div>
        <p style="font-size: 1.1em;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>
      </div>
    `;
    return;
  }
  box.innerHTML = "";
  lessons.forEach((lesson, index) => {
    const semesterText = lesson.semester === "1" ? "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„" : "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ";
    const semesterClass = lesson.semester === "1" ? "semester-1" : "semester-2";
    const card = document.createElement("div");
    card.className = "lesson-card";
    card.style.animationDelay = `${index * 0.05}s`;
    card.innerHTML = `
      <div class="lesson-title">
        <span class="semester-badge ${semesterClass}">${semesterText}</span>
        <span>${lesson.title}</span>
      </div>
      <div class="lesson-meta">
        <div class="meta-item">ğŸ‘ï¸ <strong>${lesson.views || 0}</strong> Ù…Ø´Ø§Ù‡Ø¯Ø©</div>
        <div class="meta-item">ğŸ“… ${lesson.publish_date || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>
        <div class="meta-item">âœï¸ ${lesson.author || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</div>
      </div>
      <div class="lesson-actions">
        <button class="btn-toggle ${lesson.status === "ON" ? "on" : "off"}"
          onclick="toggleLesson('${lesson.id}', '${lesson.status === "ON" ? "OFF" : "ON"}')">
          ${lesson.status === "ON" ? "ğŸŸ¢ Ù…Ù†Ø´ÙˆØ±" : "ğŸ”´ ØºÙŠØ± Ù…Ù†Ø´ÙˆØ±"}
        </button>
        <button class="btn-edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
      </div>
    `;
    box.appendChild(card);
  });
}

function filterLessons(filter) {
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  let filtered = allLessons;
  if (filter === '1' || filter === '2') {
    filtered = allLessons.filter(l => l.semester === filter);
  } else if (filter === 'ON' || filter === 'OFF') {
    filtered = allLessons.filter(l => l.status === filter);
  }
  displayLessons(filtered);
}

// âœ… Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ (Ù…ÙƒØªÙ…Ù„Ø©)
function addLesson() {
  const title = document.getElementById("title").value.trim();
  const url = document.getElementById("url").value.trim();
  const author = document.getElementById("author").value.trim();
  const semester = document.getElementById("semester").value;

  if (!title || !url) {
    setStatus("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø±Ø§Ø¨Ø·", false);
    return;
  }

  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.innerHTML = '<span style="position: relative; z-index: 1;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...</span>';
  btn.disabled = true;

  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "add",
      password: ADMIN_PASS,
      title: title,
      url: url,
      author: author,
      semester: semester
    })
  })
  .then(r => r.json())
  .then(res => {
    btn.innerHTML = originalText;
    btn.disabled = false;
    if (res.success) {
      setStatus("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­", true);
      document.getElementById("title").value = "";
      document.getElementById("url").value = "";
      document.getElementById("author").value = "Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ";
      document.getElementById("semester").value = "1";
      loadLessons();
    } else {
      setStatus("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³", false);
    }
  })
  .catch(err => {
    btn.innerHTML = originalText;
    btn.disabled = false;
    setStatus("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", false);
    console.error("Add error:", err);
  });
}

// âœ… Ø¯Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø¯Ø±Ø³ (Ù…ÙƒØªÙ…Ù„Ø©)
function toggleLesson(id, newStatus) {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "toggle",
      password: ADMIN_PASS,
      id: id,
      status: newStatus
    })
  })
  .then(r => r.json())
  .then(res => {
    if (res.success) {
      loadLessons(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    } else {
      alert("âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + (res.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
    }
  })
  .catch(err => {
    console.error("Toggle error:", err);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„");
  });
}

// âœ… Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…ÙƒØªÙ…Ù„Ø©)
function goHome() {
  // âœ… ØºÙŠÙ‘Ø± Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù„Ù Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø§Ø³Ù… Ù…Ø®ØªÙ„Ù Ø£Ùˆ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø±
  window.location.href = "public.html";
}

// Ø¯ÙˆØ§Ù„ ØºÙŠØ± Ù…ÙØ¹Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
function showSemesterStats() {
  alert("ğŸ“Š Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±.");
}
</script>

</body>
</html>
