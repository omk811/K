<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:"Cairo",sans-serif;
  background:linear-gradient(135deg,#0f0f1e,#16213e);
  color:#f1f5f9;
  min-height:100vh;
  padding:20px
}
.container{max-width:1100px;margin:auto}

/* Ø£Ø²Ø±Ø§Ø± */
.btn{
  padding:12px 18px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  font-family:inherit;
  font-weight:700;
  transition:.3s
}
.btn:hover{transform:translateY(-2px)}
.btn-success{background:#10b981;color:#fff}
.btn-secondary{background:#374151;color:#fff}
.btn-warning{background:#f59e0b;color:#fff}
.btn-danger{background:#ef4444;color:#fff}
.btn-primary{background:#8b5cf6;color:#fff}

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-card{
  max-width:420px;
  margin:120px auto;
  background:#1e1e2e;
  padding:40px;
  border-radius:20px;
  text-align:center
}
.login-card h2{color:#a78bfa;margin-bottom:10px}
.login-card input{
  width:100%;
  padding:16px;
  border-radius:12px;
  border:2px solid #8b5cf6;
  background:#0f172a;
  color:#fff;
  margin:20px 0
}

/* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
.hidden{display:none}
.panel-header{
  background:#1e1e2e;
  padding:30px;
  border-radius:20px;
  margin-bottom:25px;
  text-align:center;
  position:relative
}
.panel-header h2{color:#a78bfa}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
.home-icon,.refresh-icon{
  position:absolute;
  top:20px;
  width:44px;
  height:44px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer;
  transition:.3s;
  box-shadow:0 8px 25px rgba(0,0,0,.4)
}
.home-icon{
  right:20px;
  background:linear-gradient(135deg,#8b5cf6,#6d28d9)
}
.refresh-icon{
  left:20px;
  background:linear-gradient(135deg,#10b981,#059669)
}
.home-icon:hover,.refresh-icon:hover{
  transform:scale(1.1)
}

/* Ø¨Ø·Ø§Ù‚Ø§Øª */
.card{
  background:#1e1e2e;
  padding:25px;
  border-radius:18px;
  margin-bottom:25px
}

/* Ø§Ù„Ø¯Ø±ÙˆØ³ */
.lesson-card{
  background:#0f172a;
  border:1px solid #8b5cf633;
  border-radius:16px;
  padding:20px;
  margin-bottom:15px
}
.lesson-title{
  font-weight:700;
  margin-bottom:10px;
  display:flex;
  gap:10px;
  align-items:center
}
.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:700
}
.b1{background:#3b82f6}
.b2{background:#10b981}
.meta{font-size:14px;color:#cbd5e1;margin-bottom:10px}
.actions{display:flex;gap:8px;flex-wrap:wrap}

input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:2px solid #8b5cf6;
  background:#020617;
  color:#fff;
  margin-bottom:8px
}
</style>
</head>

<body>
<div class="container">

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox" class="login-card">
  <h2>ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
  <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button class="btn btn-primary" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <div id="loginMsg"></div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div id="panel" class="hidden">

  <div class="panel-header">
    <div class="home-icon" onclick="goHome()" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">ğŸ </div>
    <div class="refresh-icon" onclick="manualRefresh()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">ğŸ”„</div>
    <h2>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h2>
    <p>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</p>
  </div>

  <div class="card">
    <h3>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h3>
    <div id="list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
  </div>

</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbxuf794HZmIMIjofGEunan_GRJNH6Npn_fHcZsMZShss90Z4ilPRwpQjRVUGJd2fOSqnw/exec";
let ADMIN_PASS="";
let allLessons=[];
let editingId=null;

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
function login(){
  ADMIN_PASS=pass.value.trim();
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"get",password:ADMIN_PASS})
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.error){
      loginMsg.textContent="âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    }else{
      loginBox.classList.add("hidden");
      panel.classList.remove("hidden");
      loadLessons();
    }
  });
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø±ÙˆØ³ */
function loadLessons(){
  list.textContent="â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"get",password:ADMIN_PASS})
  })
  .then(r=>r.json())
  .then(data=>{
    allLessons=data.filter(l=>l.status!=="DELETED");
    render(allLessons);
  });
}

/* ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ */
function manualRefresh(){
  list.textContent="ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...";
  loadLessons();
}

/* Ø¹Ø±Ø¶ */
function render(arr){
  list.innerHTML="";
  arr.forEach(l=>{
    const div=document.createElement("div");
    div.className="lesson-card";

    if(editingId===l.id){
      div.innerHTML=`
        <input id="e-title" value="${l.title}">
        <input id="e-url" value="${l.url}">
        <input id="e-author" value="${l.author||""}">
        <select id="e-sem">
          <option value="1" ${l.semester==="1"?"selected":""}>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</option>
          <option value="2" ${l.semester==="2"?"selected":""}>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
        </select>
        <div class="actions">
          <button class="btn btn-success" onclick="saveEdit('${l.id}')">ğŸ’¾ Ø­ÙØ¸</button>
          <button class="btn btn-secondary" onclick="cancelEdit()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      `;
    }else{
      div.innerHTML=`
        <div class="lesson-title">
          <span class="badge ${l.semester==="1"?"b1":"b2"}">
            ${l.semester==="1"?"Ø§Ù„Ø£ÙˆÙ„":"Ø§Ù„Ø«Ø§Ù†ÙŠ"}
          </span>
          ${l.title}
        </div>
        <div class="meta">
          âœï¸ ${l.author||"-"} | ğŸ“… ${l.publish_date||"-"}
        </div>
        <div class="actions">
          <button class="btn btn-warning" onclick="startEdit('${l.id}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn btn-danger" onclick="delLesson('${l.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
      `;
    }
    list.appendChild(div);
  });
}

/* ØªØ¹Ø¯ÙŠÙ„ */
function startEdit(id){editingId=id;render(allLessons)}
function cancelEdit(){editingId=null;render(allLessons)}

function saveEdit(id){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"edit",
      password:ADMIN_PASS,
      id:id,
      title:document.getElementById("e-title").value,
      url:document.getElementById("e-url").value,
      author:document.getElementById("e-author").value,
      semester:document.getElementById("e-sem").value
    })
  }).then(()=>{editingId=null;loadLessons()});
}

/* Ø­Ø°Ù */
function delLesson(id){
  if(!confirm("âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø³ØŸ")) return;
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"toggle",
      password:ADMIN_PASS,
      id:id,
      status:"DELETED"
    })
  }).then(()=>loadLessons());
}

/* Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
function goHome(){
  window.location.href="public.html";
}
</script>

</body>
</html>
