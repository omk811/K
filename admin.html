<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¯Ø±ÙˆØ³ ÙˆÙ†Ø´Ø±Ù‡Ø§ </title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:"Cairo",sans-serif;
  background:#0a0a14;
  color:#f1f5f9;
  margin:0;
}

.card{
  max-width:800px;
  margin:40px auto;
  background:rgba(139,92,246,.15);
  padding:25px;
  border-radius:20px;
}

h2{
  margin-top:0;
  color:#a78bfa;
}

input,button{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:12px;
  border:none;
  font-family:inherit;
}

button{
  background:#8b5cf6;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

button.secondary{
  background:#374151;
}

button.refresh{
  background:#0ea5e9;
}

button.success{
  background:#10b981;
}

.lesson{
  background:rgba(0,0,0,.3);
  padding:12px;
  border-radius:14px;
  margin-bottom:10px;
}

.lesson small{
  color:#cbd5e1;
  font-size:13px;
}

.on{background:#10b981;}
.off{background:#ef4444;}

.hidden{display:none;}

.status-msg{
  text-align:center;
  margin-top:10px;
  font-weight:700;
}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox" class="card">
  <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
  <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <p id="loginMsg"></p>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div id="panel" class="card hidden">

  <h2>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</h2>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
  <button class="secondary" onclick="goHome()">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button class="refresh" onclick="loadLessons()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§</button>

  <hr>

  <!-- Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ -->
  <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³">
  <input id="url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø±Ø³">
  <input id="author" placeholder="Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ">

  <button class="success" onclick="addLesson()">â• Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³</button>

  <div id="status" class="status-msg"></div>

  <hr>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³ -->
  <div id="list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbx61Y4tVA1j_L2c2_3EoVQX7hb5Ysh5tbFvavj2M48ZwCmWvH78Qd5uwYtUwiV-BkD5tQ/exec";
let ADMIN_PASS = "";

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
function login(){
  ADMIN_PASS = document.getElementById("pass").value.trim();
  if(!ADMIN_PASS) return;

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"get",
      password:ADMIN_PASS
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.error){
      document.getElementById("loginMsg").textContent = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    }else{
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("panel").classList.remove("hidden");
      loadLessons();
    }
  });
}

/* Ø¬Ù„Ø¨ Ø§Ù„Ø¯Ø±ÙˆØ³ */
function loadLessons(){
  document.getElementById("list").innerHTML = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...";
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"get",
      password:ADMIN_PASS
    })
  })
  .then(r=>r.json())
  .then(data=>{
    const box = document.getElementById("list");
    box.innerHTML = "";
    data.forEach(l=>{
      box.innerHTML += `
        <div class="lesson">
          <strong>${l.title}</strong><br>
          <small>ğŸ‘ï¸ ${l.views} Ø²ÙŠØ§Ø±Ø©</small><br>
          <small>ğŸ—“ï¸ ${l.publish_date || ""}</small><br>
          <small>âœï¸ ${l.author || ""}</small><br><br>
          <button class="${l.status=="ON"?"on":"off"}"
            onclick="toggleLesson('${l.id}','${l.status=="ON"?"OFF":"ON"}')">
            ${l.status}
          </button>
        </div>
      `;
    });
  });
}

/* Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ */
function addLesson(){
  const title = document.getElementById("title").value.trim();
  const url   = document.getElementById("url").value.trim();
  const author= document.getElementById("author").value.trim();

  if(!title || !url){
    setStatus("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø±Ø§Ø¨Ø·", false);
    return;
  }

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"add",
      password:ADMIN_PASS,
      title:title,
      url:url,
      author:author
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.success){
      setStatus("âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­", true);
      document.getElementById("title").value="";
      document.getElementById("url").value="";
      document.getElementById("author").value="";
      loadLessons();
    }
  });
}

/* ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø±Ø³ */
function toggleLesson(id,status){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"toggle",
      password:ADMIN_PASS,
      id:id,
      status:status
    })
  })
  .then(()=>loadLessons());
}

/* Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø© */
function setStatus(msg, success){
  const s = document.getElementById("status");
  s.textContent = msg;
  s.style.color = success ? "#10b981" : "#ef4444";
  setTimeout(()=>{ s.textContent=""; }, 3000);
}

/* Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
function goHome(){
  window.location.href = "index.html";
}
</script>

</body>
</html>
